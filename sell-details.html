<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Your Product</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 p-6">
    <div class="max-w-md mx-auto bg-white rounded-3xl shadow-lg p-6">
        
        <div class="flex items-center mb-6">
            <button onclick="location.href='buysell.html'" class="text-gray-500 mr-4">
                <i class="fa-solid fa-arrow-left text-xl"></i>
            </button>
            <h2 class="text-xl font-bold text-gray-800">Product Details</h2>
        </div>

        <div class="space-y-4">
            <div class="relative">
                <input type="file" id="pImage" accept="image/*" class="hidden" onchange="previewImage(this)">
                <label for="pImage" id="uploadLabel" class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:bg-gray-50 transition bg-center bg-cover bg-no-repeat">
                    <div id="placeholderText" class="text-center">
                        <i class="fa-solid fa-cloud-arrow-up text-3xl text-orange-400 mb-2"></i>
                        <p class="text-xs text-gray-400 font-bold">Click to Upload Image</p>
                    </div>
                </label>
            </div>

            <input id="pName" type="text" placeholder="Product Name" class="w-full p-4 bg-gray-100 rounded-xl outline-none">
            <textarea id="pDesc" placeholder="Description" class="w-full p-4 bg-gray-100 rounded-xl outline-none h-24"></textarea>
            
            <div class="flex gap-4">
                <input id="pRate" type="number" placeholder="Rate (â‚¹)" class="w-1/2 p-4 bg-gray-100 rounded-xl outline-none">
                <input id="pGpay" type="text" placeholder="GPay Link" class="w-1/2 p-4 bg-gray-100 rounded-xl outline-none">
            </div>

            <button onclick="saveAndRedirect()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg transition active:scale-95 mt-4">
                LIST PRODUCT
            </button>
        </div>
    </div>

    <script>
        let base64Image = "";

        // 1. Convert Image to Text String
        function previewImage(input) {
            const file = input.files[0];
            if (file) {
                // Limit size to 500KB to prevent errors
                if (file.size > 500000) {
                    alert("Image too large. Please choose a smaller image.");
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    base64Image = e.target.result;
                    // Show preview
                    document.getElementById('uploadLabel').style.backgroundImage = `url(${base64Image})`;
                    document.getElementById('placeholderText').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        // 2. Save Data & Go to Market
        function saveAndRedirect() {
            const name = document.getElementById('pName').value;
            const desc = document.getElementById('pDesc').value;
            const rate = document.getElementById('pRate').value;
            const gpay = document.getElementById('pGpay').value;

            if (!name || !rate) {
                alert("Please enter at least a Name and Rate.");
                return;
            }

            const newProduct = {
                id: Date.now(), // Unique ID
                name: name,
                desc: desc,
                rate: rate,
                gpay: gpay,
                image: base64Image || "https://via.placeholder.com/150" // Fallback image
            };

            // Get existing list, add new item, save back
            let productList = JSON.parse(localStorage.getItem('ecoProducts')) || [];
            productList.push(newProduct);
            localStorage.setItem('ecoProducts', JSON.stringify(productList));

            // Redirect
            window.location.href = 'buysell.html';
        }
    </script>
</body>
</html>